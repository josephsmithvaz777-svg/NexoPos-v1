import{b as C,n as _,P as N,F as B}from"./bootstrap-DI8pXSaz.js";import{N as D,n as L}from"./ns-prompt-popup-A2hkmxyC.js";import{_ as m}from"./lang-BINodpp-.js";import{n as M}from"./currency-BCJk0SN4.js";import{v as A,a as J,b as R}from"./runtime-dom.esm-bundler-BJBE8XOq.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as l,o as a,b as r,a as p,B as S,t as u,F as g,e as y,m as G,r as k,f as U,w as T,i as F,n as V,A as I,g as P}from"./runtime-core.esm-bundler-DUdZl5j1.js";import{N as Y}from"./components-DqSn6SeA.js";import"./chart-BXKSDqJb.js";import"./ns-avatar-C2owAxZ8.js";import"./ns-avatar-image-BehlO75A.js";const H={name:"ns-product-group",props:["fields"],watch:{searchValue(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.searchProducts(this.searchValue)},1e3)},products:{deep:!0,handler(){this.$forceUpdate()}}},computed:{totalProducts(){return this.products.length>0?(this.$emit("update",this.products),this.products.map(e=>parseFloat(e.sale_price)*parseFloat(e.quantity)).reduce((e,t)=>e+t)):0}},mounted(){const e=this.fields.filter(t=>t.name==="product_subitems");e.length>0&&e[0].value!==void 0&&e[0].value.length>0&&(this.products=e[0].value)},data(){return{searchValue:"",searchTimeout:null,results:[],products:[]}},methods:{__:m,nsCurrency:M,setSalePrice(){this.$emit("updateSalePrice",this.totalProducts)},removeProduct(e){N.show(L,{title:m("Delete Sub item"),message:m("Would you like to delete this sub item?"),onAction:t=>{t&&this.products.splice(e,1)}})},toggleUnitField(e){e._unit_toggled||(e._unit_toggled=!e._unit_toggled),setTimeout(()=>{e._unit_toggled&&this.$refs.unitField[0].addEventListener("blur",()=>{e._unit_toggled=!1,this.$forceUpdate()})},200)},toggleQuantityField(e){e._quantity_toggled=!e._quantity_toggled,setTimeout(()=>{e._quantity_toggled&&(this.$refs.quantityField[0].select(),this.$refs.quantityField[0].addEventListener("blur",()=>{this.toggleQuantityField(e),this.$forceUpdate()}))},200)},togglePriceField(e){e._price_toggled=!e._price_toggled,setTimeout(()=>{e._price_toggled&&(this.$refs.priceField[0].select(),this.$refs.priceField[0].addEventListener("blur",()=>{this.togglePriceField(e),this.$forceUpdate()}))},200)},redefineUnit(e){const t=e.unit_quantities.filter(n=>n.id===e.unit_quantity_id);t.length>0&&(e.unit_quantity=t[0],e.unit_id=t[0].unit.id,e.unit=t[0].unit,e.sale_price=t[0].sale_price)},async addResult(e){if(this.searchValue="",e.type==="grouped")return _.error(m("Unable to add a grouped product."));try{const t=await new Promise((o,s)=>{N.show(D,{label:m("Choose The Unit"),options:e.unit_quantities.map(i=>({label:i.unit.name,value:i.id})),resolve:o,reject:s})}),n=e.unit_quantities.filter(o=>parseInt(o.id)===parseInt(t));this.products.push({name:e.name,unit_quantity_id:t,unit_quantity:n[0],unit_id:n[0].unit.id,unit:n[0].unit,product_id:n[0].product_id,quantity:1,_price_toggled:!1,_quantity_toggled:!1,_unit_toggled:!1,unit_quantities:e.unit_quantities,sale_price:n[0].sale_price}),this.$emit("update",this.products)}catch(t){console.log(t)}},searchProducts(e){if(e.length===0)return null;C.post("/api/products/search",{search:e,arguments:{type:{comparison:"<>",value:"grouped"},searchable:{comparison:"in",value:[0,1]}}}).subscribe({next:t=>{this.results=t},error:t=>{_.error(t.message||m("An unexpected error occurred"),m("Ok"),{duration:3e3})}})}}},z={class:"flex flex-col px-4 w-full"},X={class:"md:-mx-4 flex flex-col md:flex-row"},Z={class:"md:px-4 w-full"},ee={class:"input-group border-2 rounded info flex w-full"},te=["placeholder"],se={key:0,class:"h-0 relative"},ie={class:"ns-vertical-menu absolute w-full"},re=["onClick"],ne={class:"my-2"},oe={class:"ns-table"},ae={colspan:"2",class:"border"},le={colspan:"2",class:"border p-2"},de={class:"flex justify-between"},ue={class:"font-bold"},ce=["onClick"],fe=["onClick"],he={class:"input-group"},me=["onChange","onUpdate:modelValue"],pe=["value"],be=["onClick"],_e={key:0,class:"cursor-pointer border-b border-dashed border-info-secondary"},ge=["onUpdate:modelValue"],ve=["onClick"],ye={key:0,class:"cursor-pointer border-b border-dashed border-info-secondary"},xe=["onUpdate:modelValue"],we={key:0},ke={colspan:"2",class:"border p-2 text-center"},Ue={key:0},Ce={class:"w-1/2 border p-2 text-left"},Fe={class:"w-1/2 border p-2 text-right"};function Ve(e,t,n,o,s,i){return a(),l("div",z,[r("div",X,[r("div",Z,[r("div",ee,[S(r("input",{placeholder:i.__("Search products..."),"onUpdate:modelValue":t[0]||(t[0]=d=>s.searchValue=d),type:"text",class:"flex-auto p-2 outline-hidden"},null,8,te),[[A,s.searchValue]]),r("button",{onClick:t[1]||(t[1]=d=>i.setSalePrice()),class:"px-2"},u(i.__("Set Sale Price")),1)]),s.results.length>0&&s.searchValue.length>0?(a(),l("div",se,[r("ul",ie,[(a(!0),l(g,null,y(s.results,d=>(a(),l("li",{key:d.id,onClick:v=>i.addResult(d),class:"p-2 border-b cursor-pointer"},u(d.name),9,re))),128))])])):p("",!0),r("div",ne,[r("table",oe,[r("thead",null,[r("tr",null,[r("th",ae,u(i.__("Products")),1)])]),r("tbody",null,[(a(!0),l(g,null,y(s.products,(d,v)=>(a(),l("tr",{key:v},[r("td",le,[r("div",de,[r("h3",ue,u(d.name),1),r("span",{onClick:h=>i.removeProduct(v),class:"hover:underline text-error-secondary cursor-pointer"},u(i.__("Remove")),9,ce)]),r("ul",null,[r("li",{onClick:h=>i.toggleUnitField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[r("span",null,u(i.__("Unit"))+":",1),r("div",he,[S(r("select",{onChange:h=>i.redefineUnit(d),ref_for:!0,ref:"unitField",type:"text","onUpdate:modelValue":h=>d.unit_quantity_id=h},[(a(!0),l(g,null,y(d.unit_quantities,h=>(a(),l("option",{key:h.id,value:h.id},u(h.unit.name)+" ("+u(h.quantity)+")",9,pe))),128))],40,me),[[J,d.unit_quantity_id]])])],8,fe),r("li",{onClick:h=>i.toggleQuantityField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[r("span",null,u(i.__("Quantity"))+":",1),d._quantity_toggled?p("",!0):(a(),l("span",_e,u(d.quantity),1)),d._quantity_toggled?S((a(),l("input",{key:1,ref_for:!0,ref:"quantityField",type:"text","onUpdate:modelValue":h=>d.quantity=h},null,8,ge)),[[A,d.quantity]]):p("",!0)],8,be),r("li",{onClick:h=>i.togglePriceField(d),class:"flex justify-between p-1 hover:bg-box-elevation-hover"},[r("span",null,u(i.__("Price"))+":",1),d._price_toggled?p("",!0):(a(),l("span",ye,u(i.nsCurrency(d.sale_price)),1)),d._price_toggled?S((a(),l("input",{key:1,ref_for:!0,ref:"priceField",type:"text","onUpdate:modelValue":h=>d.sale_price=h},null,8,xe)),[[A,d.sale_price]]):p("",!0)],8,ve)])])]))),128)),s.products.length===0?(a(),l("tr",we,[r("td",ke,u(i.__("No product are added to this group.")),1)])):p("",!0)]),s.products.length>0?(a(),l("tfoot",Ue,[r("tr",null,[r("td",Ce,u(i.__("Total")),1),r("td",Fe,u(i.nsCurrency(i.totalProducts)),1)])])):p("",!0)])])])])])}const Se=Q(H,[["render",Ve]]),Te={components:{nsProductGroup:Se},data:()=>({formValidation:new B,nsSnackBar:_,nsHttpClient:C,_sampleVariation:null,unitLoaded:!1,unitLoadError:!1,form:G({}),hasLoaded:!1,hasError:!1,isWatching:!1,lastProductName:""}),watch:{form:{deep:!0,handler(e){this.isWatching||(this.isWatching=!0,this.form.variations.forEach(t=>{if(this.formValidation.extractFields(t.tabs.identification.fields).type==="grouped"){for(let s in t.tabs)["identification","groups","taxes","units"].includes(s)||(t.tabs[s].visible=!1);t.tabs.groups&&(t.tabs.groups.visible=!0)}else{for(let s in t.tabs)["identification","groups","taxes","units"].includes(s)||(t.tabs[s].visible=!0);t.tabs.groups&&(t.tabs.groups.visible=!1)}let o=!1;t.tabs.units.fields.forEach(s=>{s.name==="selling_group"&&s.groups.forEach(i=>{o=i.fields.filter(d=>d.name==="id").length>0})}),t.tabs.units.fields.forEach(s=>{s.name==="unit_group"&&o?(s.disabled=!0,s.about=m("You can't change the unit group as there are already unit quantities attached to the product. You might need to delete the Selling Unit.")):(s.disabled=!1,s.about=!1)})}),this.form.main.value&&this.form.main.value!==this.lastProductName&&(this.form.variations.forEach((t,n)=>{const o=t.tabs.identification.fields.find(s=>s.name==="sku");o&&!o.value&&(o.value=this.slugify(this.form.main.value))}),this.lastProductName=this.form.main.value),nsHooks.doAction("ns-products-form-updated",e),setTimeout(()=>{this.isWatching=!1},100))}}},computed:{defaultVariation(){const e=new Object;for(let t in this._sampleVariation.tabs)e[t]=new Object,e[t].label=this._sampleVariation.tabs[t].label,e[t].active=this._sampleVariation.tabs[t].active,e[t].fields=this._sampleVariation.tabs[t].fields.filter(n=>!["category_id","product_type","stock_management","expires"].includes(n.name)).map(n=>((typeof n.value=="string"&&n.value.length===0||n.value===null)&&(n.value=""),n));return{id:"",tabs:e}}},props:["submitMethod","submitUrl","returnUrl","src","units-url","unitSrc","unitSubmitUrl"],methods:{__:m,nsCurrency:M,handleUnitGroupFieldChanged(e,t){e.name==="unit_id"&&(t.label=this.getFirstSelectedUnit(t.fields))},async handleSaved(e,t,n,o){e.data.entry&&(o.options.push({label:e.data.entry[o.props.optionAttributes.label],value:e.data.entry[o.props.optionAttributes.value]}),o.value=e.data.entry[o.props.optionAttributes.value])},getGroupProducts(e){if(e.groups){const t=e.groups.fields.filter(n=>n.name==="products_subitems");if(t.length>0)return t[0].value}return[]},setProducts(e,t){t.groups.fields.forEach(n=>{n.name==="product_subitems"&&(n.value=e)})},getUnitQuantity(e){const t=e.filter(n=>n.name==="quantity").map(n=>n.value);return t.length>0?t[0]:0},handleClosingTab(e,t){const n=e.identifier.substr(4),o=t[n];if(o===void 0)return _.error(m("Unable to proceed, the group you're trying to delete doesn't exist. This might be a serious issue, please contact the support."));this.removeUnitPriceGroup(o,t)},removeUnitPriceGroup(e,t){const n=e.fields.filter(o=>o.name==="id"&&!["",void 0,null].includes(o.value));Popup.show(L,{title:m("Confirm Your Action"),message:m("Would you like to delete this group ?"),onAction:o=>{if(o)if(n.length>0)this.confirmUnitQuantityDeletion({group:e,groups:t});else{const s=t.indexOf(e);t.splice(s,1)}}})},confirmUnitQuantityDeletion({group:e,groups:t}){Popup.show(L,{title:m("Your Attention Is Required"),size:"w-[75vw] h-[40vh]",message:m("The current unit you're about to delete has a reference on the database and it might have already procured stock. Deleting that reference will remove procured stock. Would you proceed ?"),onAction:n=>{if(n){const o=e.fields.filter(s=>s.name==="id").map(s=>s.value)[0];C.delete(`/api/products/units/quantity/${o}`).subscribe({next:s=>{const i=t.indexOf(e);t.splice(i,1),_.success(s.message)},error:s=>{_.error(s.message)}})}}})},addUnitGroup(e,t){if(e.options.length===0)return _.error(m("Please select at least one unit group before you proceed."));if(e.options.length>e.groups.length){const n=e.groups;e.groups=[],setTimeout(()=>{e.groups=[...n,{label:this.getFirstSelectedUnit(e.fields),closable:!0,fields:JSON.parse(JSON.stringify(e.fields))}]},1)}else _.error(m("There shoulnd't be more option than there are units."))},handleSaveEvent(e,t,n){const{variation_index:o}=n;t.options.push({label:e.data.entry[t.props.optionAttributes.label],value:e.data.entry[t.props.optionAttributes.value]}),t.value=e.data.entry[t.props.optionAttributes.value],t.name==="unit_group"&&(this.getActiveTab(this.form.variations[o].tabs).unit_group_id=t.value);try{this.loadUnits(this.getActiveTab(this.form.variations[o].tabs),t.value)}catch(s){console.log({exception:s})}},loadUnits(e,t){return new Promise((n,o)=>{C.get(this.unitsUrl.replace("{id}",t)).subscribe({next:s=>{if(s.length===0)return this.unitLoadError=!0,o(!1);e.fields.forEach(i=>{i.type==="group"&&(i.options=s,i.fields.forEach(d=>{["unit_id","convert_unit_id"].includes(d.name)&&(d.options=s.map(v=>({label:v.name,value:v.id})))}))}),this.unitLoaded=!0,n(!0)},error:s=>{o(!1),this.unitLoadError=!0}})})},async loadAvailableUnits(e,t){if(t.name!=="unit_group")return;this.unitLoaded=!1,this.unitLoadError=!1;const n=e.fields.filter(o=>o.name==="unit_group")[0].value;e.unit_group_id=n;try{n!==void 0&&await this.loadUnits(e,n)}catch(o){console.log({exception:o})}},submit(){if(this.formValidation.validateFields([this.form.main]),this.form.variations.map(s=>this.formValidation.validateForm(s)).filter(s=>s.length>0).length>0||Object.values(this.form.main.errors).length>0)return _.error(m("Unable to proceed the form is not valid."));const t=this.form.variations.map((s,i)=>s.tabs.images.groups.filter(d=>d.filter(v=>v.name==="featured"&&v.value===1).length>0));if(t[0]&&t[0].length>1)return _.error(m("Unable to proceed, more than one product is set as featured"));const n=[];if(this.form.variations.map((s,i)=>s.tabs.units.fields.filter(d=>d.type==="group").forEach(d=>{d.groups.forEach(v=>{n.push(this.formValidation.validateFields(v.fields))})})),n.length===0)return _.error(m("Either Selling or Purchase unit isn't defined. Unable to proceed."));if(n.filter(s=>s===!1).length>0)return this.$forceUpdate(),_.error(m("Unable to proceed as one of the unit group field is invalid"));const o={...this.formValidation.extractForm(this.form),variations:this.form.variations.map((s,i)=>{const d=this.formValidation.extractForm(s);i===0&&(d.$primary=!0),d.images=s.tabs.images.groups.map(h=>this.formValidation.extractFields(h));const v=new Object;return s.tabs.units.fields.filter(h=>h.type==="group").forEach(h=>{v[h.name]=h.groups.map(q=>this.formValidation.extractFields(q.fields))}),d.units={...d.units,...v},d})};this.formValidation.disableForm(this.form),C[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,o).subscribe(s=>{if(s.status==="success"){if(this.submitMethod==="POST"&&this.returnUrl!==!1)return document.location=s.data.editUrl||this.returnUrl;_.info(s.message,m("Okay"),{duration:3e3}),this.$emit("saved")}this.formValidation.enableForm(this.form)},s=>{_.error(s.message,void 0,{duration:5e3}),this.formValidation.enableForm(this.form),s.response&&this.formValidation.triggerError(this.form,s.response.data)})},deleteVariation(e){confirm(m("Would you like to delete this variation ?"))&&this.form.variations.splice(e,1)},setTabActive(e,t){for(let n in t)n!==e&&(t[n].active=!1);if(t[e].active=!0,e==="units"){const n=t[e].fields.filter(o=>o.name==="unit_group");n.length>0&&this.loadAvailableUnits(t[e],n[0])}},duplicate(e){this.form.variations.push(Object.assign({},e))},newVariation(){this.form.variations.push(this.defaultVariation)},getActiveTab(e){for(let t in e)if(e[t].active)return e[t];return!1},getActiveTabKey(e){for(let t in e)if(e[t].active)return t;return!1},parseForm(e){return e.main.value=e.main.value===void 0?"":e.main.value,e.main=this.formValidation.createFields([e.main])[0],e.variations.forEach((t,n)=>{let o=0;for(let s in t.tabs)o===0&&t.tabs[s].active===void 0?(t.tabs[s].active=!0,this._sampleVariation=JSON.parse(JSON.stringify(t)),t.tabs[s].fields&&(t.tabs[s].fields=this.formValidation.createFields(t.tabs[s].fields.filter(i=>i.name!=="name")))):t.tabs[s].fields&&(t.tabs[s].fields=this.formValidation.createFields(t.tabs[s].fields)),t.tabs[s].active=t.tabs[s].active===void 0?!1:t.tabs[s].active,t.tabs[s].visible=t.tabs[s].visible===void 0?!0:t.tabs[s].visible,o++}),e},loadForm(){return new Promise((e,t)=>{const n=this.src+(this.src.includes("?")?"&":"?")+window.location.search.substring(1),o=C.get(n);this.hasLoaded=!1,this.hasError=!1,o.subscribe({next:s=>{e(s),this.hasLoaded=!0,this.form=G(this.parseForm(s.form))},error:s=>{t(s),this.hasError=!0}})})},addImage(e){e.tabs.images.groups.push(this.formValidation.createFields(JSON.parse(JSON.stringify(e.tabs.images.fields))))},removeImage(e,t){const n=e.tabs.images.groups.indexOf(t);e.tabs.images.groups.splice(n,1)},handleSavedUnitGroupFields(e,t){e.data&&(t.options.push({label:e.data.entry.name,value:e.data.entry.id}),t.value=e.data.entry.id)},getGroupId(e){const t=e.filter(n=>n.name==="id");return t.length>0?t[0].value:!1},getFirstSelectedUnit(e){const t=e.filter(n=>n.name==="unit_id");if(t.length>0){const n=t[0].options.filter(o=>o.value===t[0].value);if(n.length>0)return n[0].label}return m("No Unit Selected")},async createUnit(e){try{const t=await new Promise((n,o)=>{Popup.show(Y,{title:m("Create Unit"),src:this.unitSrc,submitUrl:this.unitSubmitUrl,submitMethod:"POST",returnUrl:!1,resolve:n,reject:o})});_.success(t.message),this.loadAvailableUnits(e,{name:"unit_group",value:this.getActiveTab(this.form.variations[0].tabs).unit_group_id})}catch{}},slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},generateSku(e){const t=this.form.main.value;if(t){const n=this.slugify(t),o=this.form.variations[e].tabs.identification.fields.find(s=>s.name==="sku");o&&(o.value=n,_.info(m("SKU generated from name.")))}else _.error(m("Please enter a product name first."))}},async mounted(){await this.loadForm()},name:"ns-manage-products"},Pe={class:"form flex-auto",id:"product-form"},Ae={key:0,class:"flex items-center h-full justify-center flex-auto"},qe={key:1},Ee={class:"flex flex-col"},je={class:"flex justify-between items-center"},Le={for:"title",class:"font-bold my-2 text-font"},Oe={for:"title",class:"text-sm my-2 text-font"},Ne=["href"],Ge=["disabled"],Ie=["disabled"],Me={key:0,class:"text-xs text-fontcolor py-1"},Qe={id:"form-container",class:"-mx-4 flex flex-wrap mt-4"},We={class:"px-4 w-full"},Ke={id:"card-header",class:"flex flex-wrap justify-between ns-tab ml-4"},$e={class:"flex flex-wrap"},Be=["onClick"],De={key:0,class:"rounded-full bg-error-secondary text-white h-6 w-6 flex font-semibold items-center justify-center"},Je={class:"card-body ns-tab-item"},Re={class:"rounded shadow p-2"},Ye={key:0,class:"-mx-4 flex flex-wrap"},He={key:0,class:"absolute top-0 right-4 h-8 flex items-center"},ze=["onClick"],Xe={key:1,class:"-mx-4 flex flex-wrap text-font"},Ze={class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},et={class:"rounded border custom-button flex justify-between p-2 items-center"},tt=["onClick"],st={class:"rounded border custom-button flex flex-col overflow-hidden"},it={class:"p-2"},rt=["onClick"],nt={key:2,class:"-mx-4 flex flex-wrap text-font"},ot={key:3,class:"-mx-4 flex flex-wrap"},at={class:"px-4 w-full md:w-1/2 lg:w-1/3"},lt={class:"mb-2"},dt={class:"font-medium"},ut={class:"py-1 text-sm"},ct={class:"mb-2"},ft=["onClick"],ht={class:"overflow-hidden"},mt={class:"font-bold border-dashed border-input-edge border-b text-sm p-2 flex justify-between border-box-elevation-edge"},pt={class:"p-2 mb-2"},bt={class:"md:-mx-2 flex flex-wrap"},_t={key:0,class:"px-4 w-full lg:w-2/3 flex justify-center items-center"},gt={key:1,class:"px-4 w-full md:w-1/2 lg:w-2/3 flex flex-col justify-center items-center"},vt={class:"w-full md:w-1/3 py-3 text-center text-sm text-font"},yt=["onClick"],xt={key:2,class:"px-4 w-full md:w-1/2 lg:w-2/3 flex flex-col justify-center items-center"},wt={class:"w-full md:w-1/3 py-3 text-center text-sm text-font"};function kt(e,t,n,o,s,i){const d=k("ns-spinner"),v=k("ns-notice"),h=k("ns-field"),q=k("ns-product-group"),W=k("ns-tabs-item"),K=k("ns-tabs");return a(),l("div",Pe,[Object.values(e.form).length===0&&e.hasLoaded?(a(),l("div",Ae,[U(d)])):p("",!0),Object.values(e.form).length===0&&e.hasError?(a(),l("div",qe,[U(v,{color:"error"},{title:T(()=>[F(u(i.__("An Error Has Occured")),1)]),description:T(()=>[F(u(i.__("An unexpected error has occured while loading the form. Please check the log or contact the support.")),1)]),_:1})])):p("",!0),Object.values(e.form).length>0?(a(),l(g,{key:2},[r("div",Ee,[r("div",je,[r("label",Le,u(e.form.main.label),1),r("div",Oe,[n.returnUrl?(a(),l("a",{key:0,href:n.returnUrl,class:"rounded-full border ns-inset-button error hover:bg-error-tertiary px-2 py-1"},u(i.__("Return")),9,Ne)):p("",!0)])]),r("div",{class:V([e.form.main.disabled?"":e.form.main.errors.length>0?"border-error-tertiary":"","input-group info flex border rounded overflow-hidden"])},[S(r("input",{"onUpdate:modelValue":t[0]||(t[0]=f=>e.form.main.value=f),onBlur:t[1]||(t[1]=f=>e.formValidation.checkField(e.form.main)),onChange:t[2]||(t[2]=f=>e.formValidation.checkField(e.form.main)),disabled:e.form.main.disabled,type:"text",class:V([(e.form.main.disabled,""),"flex-auto text-fontcolor outline-hidden h-10 px-2"])},null,42,Ge),[[A,e.form.main.value]]),r("button",{disabled:e.form.main.disabled,class:V([e.form.main.disabled?"":e.form.main.errors.length>0?"bg-error-tertiary":"","outline-hidden px-4 h-10 rounded-none"]),onClick:t[3]||(t[3]=f=>i.submit())},[I(e.$slots,"save",{},()=>[F(u(i.__("Save")),1)])],10,Ie)],2),e.form.main.description&&e.form.main.errors.length===0?(a(),l("p",Me,u(e.form.main.description),1)):p("",!0),(a(!0),l(g,null,y(e.form.main.errors,(f,w)=>(a(),l("p",{class:"text-xs py-1 text-error-tertiary",key:w},[r("span",null,[I(e.$slots,"error-required",{},()=>[F(u(f.identifier),1)])])]))),128))]),r("div",Qe,[r("div",We,[(a(!0),l(g,null,y(e.form.variations,(f,w)=>(a(),l("div",{id:"tabbed-card",class:"mb-8",key:w},[r("div",Ke,[r("div",$e,[(a(!0),l(g,null,y(f.tabs,(c,x)=>(a(),l(g,null,[c.visible?(a(),l("div",{onClick:b=>i.setTabActive(x,f.tabs),class:V([c.active?"active":"inactive","tab cursor-pointer text-fontcolor px-4 py-2 rounded-tl-lg rounded-tr-lg flex justify-between"]),key:x},[r("span",{class:V(["block",c.errors&&c.errors.length>0?"mr-2":""])},u(c.label),3),c.errors&&c.errors.length>0?(a(),l("span",De,u(c.errors.length),1)):p("",!0)],10,Be)):p("",!0)],64))),256))]),t[4]||(t[4]=r("div",{class:"flex items-center justify-center -mx-1"},null,-1))]),r("div",Je,[r("div",Re,[["images","units","groups"].includes(i.getActiveTabKey(f.tabs))?p("",!0):(a(),l("div",Ye,[(a(!0),l(g,null,y(i.getActiveTab(f.tabs).fields,(c,x)=>(a(),l("div",{key:x,class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3 relative"},[U(h,{onSaved:b=>i.handleSaved(b,i.getActiveTabKey(f.tabs),w,c),field:c},null,8,["onSaved","field"]),c.name==="sku"?(a(),l("div",He,[r("button",{onClick:R(b=>i.generateSku(w),["prevent"]),class:"text-[10px] text-info-secondary hover:text-info-primary font-bold uppercase tracking-wider bg-info-secondary/10 px-2 py-0.5 rounded border border-info-secondary/20"},[t[5]||(t[5]=r("i",{class:"las la-sync mr-1"},null,-1)),F(u(i.__("Generate")),1)],8,ze)])):p("",!0)]))),128))])),i.getActiveTabKey(f.tabs)==="images"?(a(),l("div",Xe,[r("div",Ze,[r("div",et,[r("span",null,u(i.__("Add Images")),1),r("button",{onClick:c=>i.addImage(f),class:"outline-hidden rounded-full border flex items-center justify-center w-8 h-8 ns-inset-button info"},[...t[6]||(t[6]=[r("i",{class:"las la-plus-circle"},null,-1)])],8,tt)])]),(a(!0),l(g,null,y(i.getActiveTab(f.tabs).groups,(c,x)=>(a(),l("div",{key:x,class:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3 mb-4"},[r("div",st,[r("div",it,[(a(!0),l(g,null,y(c,(b,E)=>(a(),P(h,{key:E,field:b},null,8,["field"]))),128))]),r("div",{onClick:b=>i.removeImage(f,c),class:"text-center py-2 border-t custom-button text-sm cursor-pointer"},u(i.__("Remove Image")),9,rt)])]))),128))])):p("",!0),i.getActiveTabKey(f.tabs)==="groups"?(a(),l("div",nt,[U(q,{onUpdate:c=>i.setProducts(c,f.tabs),fields:i.getActiveTab(f.tabs).fields},null,8,["onUpdate","fields"])])):p("",!0),i.getActiveTabKey(f.tabs)==="units"?(a(),l("div",ot,[r("div",at,[(a(!0),l(g,null,y(i.getActiveTab(f.tabs).fields.filter(c=>c.name!=="selling_group"),c=>(a(),P(h,{onSaved:x=>i.handleSaveEvent(x,c,{variation_index:w}),onChange:x=>i.loadAvailableUnits(i.getActiveTab(f.tabs),c),field:c},null,8,["onSaved","onChange","field"]))),256))]),e.unitLoaded?(a(!0),l(g,{key:0},y(i.getActiveTab(f.tabs).fields,(c,x)=>(a(),l(g,null,[c.type==="group"?(a(),l("div",{class:"px-4 w-full lg:w-2/3",key:x},[r("div",lt,[r("label",dt,u(c.label),1),r("p",ut,u(c.description),1)]),r("div",ct,[r("div",{onClick:b=>i.addUnitGroup(c,f.tabs),class:"custom-button border border-dashed p-1 bg-box-elevation-background border-box-elevation-edge flex justify-between items-center text-fontcolor cursor-pointer rounded-lg"},[t[7]||(t[7]=r("span",{class:"rounded-full border-2 ns-inset-button info h-8 w-8 flex items-center justify-center"},[r("i",{class:"las la-plus-circle"})],-1)),r("span",null,u(i.__("New Group")),1)],8,ft)]),c.groups.length>0?(a(),P(K,{key:0,onClose:b=>i.handleClosingTab(b,c.groups),onChangeTab:b=>f.activeUnitTab=b,active:f.activeUnitTab||"tab-0"},{default:T(()=>[(a(!0),l(g,null,y(c.groups,(b,E)=>(a(),P(W,{closable:b.closable,padding:"p-2",identifier:"tab-"+E,label:b.label},{default:T(()=>[r("div",ht,[r("div",mt,[r("span",null,u(i.__("Available Quantity")),1),r("span",null,u(i.getUnitQuantity(b.fields)),1)]),r("div",pt,[r("div",bt,[(a(!0),l(g,null,y(b.fields,(O,$)=>(a(),l("div",{class:"w-full md:w-1/2 p-2",key:$},[U(h,{onChange:j=>i.handleUnitGroupFieldChanged(j,b),onSaved:j=>i.handleSavedUnitGroupFields(j,O),field:O},null,8,["onChange","onSaved","field"])]))),128))])])])]),_:2},1032,["closable","identifier","label"]))),256))]),_:2},1032,["onClose","onChangeTab","active"])):p("",!0)])):p("",!0)],64))),256)):p("",!0),i.getActiveTab(f.tabs).unit_group_id?(a(),l(g,{key:1},[!e.unitLoaded&&!e.unitLoadError?(a(),l("div",_t,[U(d)])):p("",!0),e.unitLoadError&&!e.unitLoaded?(a(),l("div",gt,[t[8]||(t[8]=r("i",{class:"las la-frown text-7xl"},null,-1)),r("p",vt,u(i.__("We were not able to load the units. Make sure there are units attached on the unit group selected.")),1),r("p",null,[r("span",{onClick:c=>i.createUnit(i.getActiveTab(f.tabs)),class:"cursor-pointer text-info-secondary border-b border-dashed p-1"},u(i.__("Create Unit")),9,yt)])])):p("",!0)],64)):(a(),l("div",xt,[t[9]||(t[9]=r("i",{class:"las la-frown text-7xl"},null,-1)),r("p",wt,u(i.__("Make sure to select a unit group before you proceed.")),1)]))])):p("",!0)])])]))),128))])])],64)):p("",!0)])}const Lt=Q(Te,[["render",kt]]);export{Lt as default};
